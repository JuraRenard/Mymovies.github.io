<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieTracker | Track & Stream Movies</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8b5cf6',
                        secondary: '#6366f1',
                        dark: '#0f172a',
                        darker: '#0c1220',
                        light: '#f1f5f9'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .movie-card {
            transition: all 0.3s ease;
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background: linear-gradient(145deg, #1e293b, #0f172a);
        }
        
        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -15px;
            top: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #8b5cf6;
        }
        
        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: -10px;
            top: 25px;
            width: 2px;
            height: calc(100% + 10px);
            background-color: #7c3aed;
        }
        
        .player-container {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .dark-toggle {
            transition: transform 0.3s ease;
        }
        
        .dark-toggle:hover {
            transform: rotate(30deg);
        }
        
        .search-bar:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
        }
        
        .dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }
        
        .nav-link {
            position: relative;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .nav-link.active {
            background-color: #8b5cf6;
            color: white;
        }
        
        .nav-link:not(.active):hover {
            background-color: #1e293b;
        }
        
        .filter-btn {
            transition: all 0.2s ease;
        }
        
        .filter-btn.active {
            background-color: #8b5cf6;
            color: white;
        }
        
        .edit-input {
            background-color: #1e293b;
            border: 1px solid #4f46e5;
            border-radius: 4px;
            padding: 4px 8px;
            width: 100%;
        }
        
        .action-btn {
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="bg-dark py-4 px-6 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fas fa-film text-primary text-2xl mr-3"></i>
                <h1 class="text-2xl font-bold">Movie<span class="text-primary">Tracker</span></h1>
            </div>
            
            <div class="flex space-x-2 mb-4 md:mb-0">
                <a href="#" id="trackerLink" class="nav-link active">
                    <i class="fas fa-list mr-2"></i> Tracker
                </a>
                <a href="#" id="streamingLink" class="nav-link">
                    <i class="fas fa-play-circle mr-2"></i> Streaming
                </a>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="relative w-full md:w-64">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search movies..." 
                        class="search-bar w-full bg-darker text-light rounded-full py-2 px-4 pl-10 focus:ring-2 focus:ring-primary transition-all"
                    >
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
                
                <button id="darkModeToggle" class="dark-toggle p-2 rounded-full bg-darker hover:bg-gray-800 transition-colors">
                    <i class="fas fa-moon text-yellow-300"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto py-8 px-4">
        <!-- Tracker Page -->
        <div id="trackerPage">
            <!-- Add Movie Section -->
            <section class="mb-12 bg-darker rounded-xl p-6 shadow-lg">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-plus-circle text-primary mr-2"></i> Add New Movie
                </h2>
                <div class="flex flex-col md:flex-row gap-4">
                    <input 
                        type="text" 
                        id="imdbIdInput" 
                        placeholder="Enter IMDb ID (e.g. tt3799232)" 
                        class="flex-grow bg-dark text-light rounded-lg py-3 px-4 focus:ring-2 focus:ring-primary transition-all"
                    >
                    <input 
                        type="text" 
                        id="movieNameInput" 
                        placeholder="Movie Name (optional)" 
                        class="flex-grow bg-dark text-light rounded-lg py-3 px-4 focus:ring-2 focus:ring-primary transition-all"
                    >
                    <select id="statusSelect" class="bg-dark text-light rounded-lg py-3 px-4 focus:ring-2 focus:ring-primary transition-all">
                        <option value="plan">Plan to Watch</option>
                        <option value="watching">Watching</option>
                        <option value="completed">Completed</option>
                    </select>
                    <button id="addMovieBtn" class="bg-primary hover:bg-secondary text-white font-medium py-3 px-6 rounded-lg transition-all flex items-center">
                        <i class="fas fa-plus mr-2"></i> Add Movie
                    </button>
                </div>
                <div class="mt-3 text-sm text-gray-400">
                    <label class="flex items-center">
                        <input type="checkbox" id="autoFetchToggle" class="mr-2">
                        Auto-fetch movie details from OMDb API
                    </label>
                </div>
            </section>

            <!-- Movie Lists -->
            <section class="mb-12">
                <div class="flex flex-wrap gap-4 mb-6">
                    <button class="filter-btn active px-4 py-2 rounded-full bg-darker hover:bg-dark font-medium" data-filter="all">
                        All Movies
                    </button>
                    <button class="filter-btn px-4 py-2 rounded-full bg-darker hover:bg-dark font-medium" data-filter="plan">
                        Plan to Watch
                    </button>
                    <button class="filter-btn px-4 py-2 rounded-full bg-darker hover:bg-dark font-medium" data-filter="watching">
                        Watching
                    </button>
                    <button class="filter-btn px-4 py-2 rounded-full bg-darker hover:bg-dark font-medium" data-filter="completed">
                        Completed
                    </button>
                </div>

                <div id="movieLists" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Plan to Watch List -->
                    <div class="list-container" data-status="plan">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold flex items-center">
                                <i class="fas fa-bookmark text-yellow-500 mr-2"></i> Plan to Watch
                            </h2>
                            <span id="planCount" class="bg-gray-700 text-gray-300 text-sm font-medium px-2.5 py-0.5 rounded-full">0</span>
                        </div>
                        <div id="planList" class="space-y-4 min-h-[200px]">
                            <!-- Movie cards will be added here -->
                        </div>
                    </div>

                    <!-- Watching List -->
                    <div class="list-container" data-status="watching">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold flex items-center">
                                <i class="fas fa-play-circle text-green-500 mr-2"></i> Watching
                            </h2>
                            <span id="watchingCount" class="bg-gray-700 text-gray-300 text-sm font-medium px-2.5 py-0.5 rounded-full">0</span>
                        </div>
                        <div id="watchingList" class="space-y-4 min-h-[200px]">
                            <!-- Movie cards will be added here -->
                        </div>
                    </div>

                    <!-- Completed List -->
                    <div class="list-container" data-status="completed">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold flex items-center">
                                <i class="fas fa-check-circle text-blue-500 mr-2"></i> Completed
                            </h2>
                            <span id="completedCount" class="bg-gray-700 text-gray-300 text-sm font-medium px-2.5 py-0.5 rounded-full">0</span>
                        </div>
                        <div id="completedList" class="space-y-4 min-h-[200px]">
                            <!-- Movie cards will be added here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- History Timeline -->
            <section>
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-history text-primary mr-2"></i> Watch History
                </h2>
                <div id="historyTimeline" class="relative pl-6 border-l-2 border-primary ml-3">
                    <!-- Timeline items will be added here -->
                </div>
            </section>
        </div>

        <!-- Streaming Page -->
        <div id="streamingPage" class="hidden">
            <div class="player-container">
                <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                    <div>
                        <h2 id="streamingTitle" class="text-xl font-bold">Now Playing</h2>
                        <p id="streamingId" class="text-gray-400 text-sm">tt0000000</p>
                    </div>
                    <div class="flex space-x-2">
                        <button id="backToTracker" class="bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded-lg transition-all">
                            <i class="fas fa-arrow-left mr-2"></i> Back to Tracker
                        </button>
                        <button id="moveToWatching" class="bg-yellow-600 hover:bg-yellow-500 text-white py-2 px-4 rounded-lg transition-all hidden">
                            <i class="fas fa-play mr-2"></i> Mark as Watching
                        </button>
                        <button id="moveToCompleted" class="bg-green-600 hover:bg-green-500 text-white py-2 px-4 rounded-lg transition-all">
                            <i class="fas fa-check mr-2"></i> Mark as Completed
                        </button>
                    </div>
                </div>
                <div class="aspect-w-16 aspect-h-9">
                    <iframe 
                        id="moviePlayer" 
                        src="" 
                        class="w-full h-96 md:h-[500px]" 
                        frameborder="0" 
                        allowfullscreen
                    ></iframe>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-dark py-6 mt-12">
        <div class="container mx-auto px-4 text-center text-gray-400">
            <p>Â© 2023 MovieTracker. Track and stream your movies with ease.</p>
        </div>
    </footer>

    <script>
        // Sample movie data for demonstration
        const sampleMovies = [
            { id: 'tt0816692', title: 'Interstellar', status: 'completed', completedDate: '2023-06-05' },
            { id: 'tt0468569', title: 'The Dark Knight', status: 'completed', completedDate: '2023-06-10' },
            { id: 'tt1375666', title: 'Inception', status: 'completed', completedDate: '2023-06-15' },
            { id: 'tt3799232', title: 'The Neon Demon', status: 'watching' },
            { id: 'tt0111161', title: 'The Shawshank Redemption', status: 'plan' }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Load movies from localStorage or use sample data
            let movies = JSON.parse(localStorage.getItem('movies')) || sampleMovies;
            let history = JSON.parse(localStorage.getItem('history')) || [];
            
            // Save to localStorage
            function saveData() {
                localStorage.setItem('movies', JSON.stringify(movies));
                localStorage.setItem('history', JSON.stringify(history));
            }
            
            // DOM Elements
            const trackerPage = document.getElementById('trackerPage');
            const streamingPage = document.getElementById('streamingPage');
            const trackerLink = document.getElementById('trackerLink');
            const streamingLink = document.getElementById('streamingLink');
            const backToTracker = document.getElementById('backToTracker');
            const addMovieBtn = document.getElementById('addMovieBtn');
            const imdbIdInput = document.getElementById('imdbIdInput');
            const movieNameInput = document.getElementById('movieNameInput');
            const statusSelect = document.getElementById('statusSelect');
            const autoFetchToggle = document.getElementById('autoFetchToggle');
            const moviePlayer = document.getElementById('moviePlayer');
            const streamingTitle = document.getElementById('streamingTitle');
            const streamingId = document.getElementById('streamingId');
            const moveToWatching = document.getElementById('moveToWatching');
            const moveToCompleted = document.getElementById('moveToCompleted');
            const searchInput = document.getElementById('searchInput');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const planList = document.getElementById('planList');
            const watchingList = document.getElementById('watchingList');
            const completedList = document.getElementById('completedList');
            const planCount = document.getElementById('planCount');
            const watchingCount = document.getElementById('watchingCount');
            const completedCount = document.getElementById('completedCount');
            const historyTimeline = document.getElementById('historyTimeline');
            
            // Navigation
            trackerLink.addEventListener('click', (e) => {
                e.preventDefault();
                trackerPage.classList.remove('hidden');
                streamingPage.classList.add('hidden');
                trackerLink.classList.add('active');
                streamingLink.classList.remove('active');
            });
            
            streamingLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentMovie) {
                    trackerPage.classList.add('hidden');
                    streamingPage.classList.remove('hidden');
                    streamingLink.classList.add('active');
                    trackerLink.classList.remove('active');
                } else {
                    alert('Please select a movie to stream');
                }
            });
            
            backToTracker.addEventListener('click', () => {
                trackerPage.classList.remove('hidden');
                streamingPage.classList.add('hidden');
                trackerLink.classList.add('active');
                streamingLink.classList.remove('active');
            });
            
            // Dark mode toggle
            darkModeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const icon = darkModeToggle.querySelector('i');
                if (document.body.classList.contains('dark-mode')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
            });
            
            // Filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    renderMovies();
                });
            });
            
            // Current movie being streamed
            let currentMovie = null;
            
            // Move to Watching
            moveToWatching.addEventListener('click', () => {
                if (currentMovie) {
                    updateMovieStatus(currentMovie.id, 'watching');
                    moveToWatching.classList.add('hidden');
                    moveToCompleted.classList.remove('hidden');
                }
            });
            
            // Move to Completed
            moveToCompleted.addEventListener('click', () => {
                if (currentMovie) {
                    updateMovieStatus(currentMovie.id, 'completed');
                    moveToWatching.classList.add('hidden');
                    moveToCompleted.classList.add('hidden');
                }
            });
            
            // Add movie
            addMovieBtn.addEventListener('click', async () => {
                const imdbId = imdbIdInput.value.trim();
                let movieName = movieNameInput.value.trim();
                const status = statusSelect.value;
                
                if (!imdbId) {
                    alert('Please enter an IMDb ID');
                    return;
                }
                
                // Validate IMDb ID format
                if (!imdbId.match(/^tt\d+$/)) {
                    alert('Please enter a valid IMDb ID (e.g. tt3799232)');
                    return;
                }
                
                // Check if movie already exists
                if (movies.some(movie => movie.id === imdbId)) {
                    alert('This movie is already in your list!');
                    return;
                }
                
                // Auto-fetch movie details if enabled
                if (autoFetchToggle.checked && !movieName) {
                    try {
                        // In a real implementation, you would use:
                        // const response = await fetch(`https://www.omdbapi.com/?i=${imdbId}&apikey=YOUR_API_KEY`);
                        // const data = await response.json();
                        // movieName = data.Title || 'Unknown Title';
                        
                        // For demo, we'll use a placeholder
                        movieName = 'Auto-fetched Movie Title';
                    } catch (error) {
                        console.error('Error fetching movie ', error);
                        movieName = 'Unknown Title';
                    }
                }
                
                // Add to movies array
                const newMovie = {
                    id: imdbId,
                    title: movieName || 'Unknown Title',
                    status: status
                };
                
                movies.push(newMovie);
                saveData();
                renderMovies();
                
                // Clear inputs
                imdbIdInput.value = '';
                movieNameInput.value = '';
            });
            
            // Render movies
            function renderMovies() {
                // Clear lists
                planList.innerHTML = '';
                watchingList.innerHTML = '';
                completedList.innerHTML = '';
                
                // Get active filter
                const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
                
                // Filter and sort movies
                const filteredMovies = activeFilter === 'all' 
                    ? [...movies] 
                    : movies.filter(movie => movie.status === activeFilter);
                
                // Search filter
                const searchTerm = searchInput.value.toLowerCase();
                const searchedMovies = filteredMovies.filter(movie => 
                    movie.id.toLowerCase().includes(searchTerm) || 
                    movie.title.toLowerCase().includes(searchTerm)
                );
                
                // Count movies by status
                const counts = { plan: 0, watching: 0, completed: 0 };
                movies.forEach(movie => counts[movie.status]++);
                planCount.textContent = counts.plan;
                watchingCount.textContent = counts.watching;
                completedCount.textContent = counts.completed;
                
                // Render movies
                searchedMovies.forEach(movie => {
                    const movieCard = createMovieCard(movie);
                    if (movie.status === 'plan') {
                        planList.appendChild(movieCard);
                    } else if (movie.status === 'watching') {
                        watchingList.appendChild(movieCard);
                    } else if (movie.status === 'completed') {
                        completedList.appendChild(movieCard);
                    }
                });
                
                // Update history timeline
                renderHistory();
            }
            
            // Create movie card
            function createMovieCard(movie) {
                const card = document.createElement('div');
                card.className = 'movie-card rounded-xl overflow-hidden cursor-pointer transform transition-transform';
                card.draggable = true;
                card.dataset.id = movie.id;
                card.dataset.status = movie.status;
                
                // Status badge
                let badgeClass = '';
                let badgeText = '';
                if (movie.status === 'plan') {
                    badgeClass = 'bg-yellow-500 text-yellow-900';
                    badgeText = 'Plan';
                } else if (movie.status === 'watching') {
                    badgeClass = 'bg-green-500 text-green-900';
                    badgeText = 'Watching';
                } else {
                    badgeClass = 'bg-blue-500 text-blue-900';
                    badgeText = 'Completed';
                }
                
                card.innerHTML = `
                    <div class="relative">
                        <div class="bg-gray-800 h-48 flex items-center justify-center">
                            <i class="fas fa-film text-5xl text-gray-600"></i>
                        </div>
                        <div class="status-badge ${badgeClass}">${badgeText}</div>
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg truncate movie-title">${movie.title}</h3>
                            <div class="flex space-x-1">
                                <button class="edit-btn action-btn text-gray-400 hover:text-yellow-400" title="Edit title">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-btn action-btn text-gray-400 hover:text-red-500" title="Delete movie">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-400 text-sm mt-1">ID: ${movie.id}</p>
                        <div class="mt-3 flex justify-between items-center">
                            <select class="status-select bg-dark text-light rounded py-1 px-2 text-sm">
                                <option value="plan" ${movie.status === 'plan' ? 'selected' : ''}>Plan to Watch</option>
                                <option value="watching" ${movie.status === 'watching' ? 'selected' : ''}>Watching</option>
                                <option value="completed" ${movie.status === 'completed' ? 'selected' : ''}>Completed</option>
                            </select>
                        </div>
                    </div>
                `;
                
                // Add click event to play movie
                card.addEventListener('click', (e) => {
                    // Don't play if clicking on action buttons
                    if (!e.target.closest('.action-btn') && !e.target.closest('.status-select')) {
                        playMovie(movie);
                    }
                });
                
                // Edit button functionality
                const editBtn = card.querySelector('.edit-btn');
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const titleElement = card.querySelector('.movie-title');
                    const currentTitle = titleElement.textContent;
                    
                    titleElement.innerHTML = `
                        <input type="text" class="edit-input" value="${currentTitle}">
                        <button class="save-edit-btn action-btn text-green-500 ml-2">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="cancel-edit-btn action-btn text-gray-400 ml-1">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    const input = titleElement.querySelector('.edit-input');
                    input.focus();
                    input.select();
                    
                    const saveBtn = titleElement.querySelector('.save-edit-btn');
                    const cancelBtn = titleElement.querySelector('.cancel-edit-btn');
                    
                    saveBtn.addEventListener('click', () => {
                        const newTitle = input.value.trim();
                        if (newTitle) {
                            updateMovieTitle(movie.id, newTitle);
                        }
                    });
                    
                    cancelBtn.addEventListener('click', () => {
                        titleElement.textContent = currentTitle;
                    });
                    
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            const newTitle = input.value.trim();
                            if (newTitle) {
                                updateMovieTitle(movie.id, newTitle);
                            }
                        }
                    });
                });
                
                // Delete button functionality
                const deleteBtn = card.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm(`Are you sure you want to delete "${movie.title}"?`)) {
                        deleteMovie(movie.id);
                    }
                });
                
                // Status change functionality
                const statusSelect = card.querySelector('.status-select');
                statusSelect.addEventListener('change', (e) => {
                    e.stopPropagation();
                    updateMovieStatus(movie.id, e.target.value);
                });
                
                // Drag and drop functionality
                card.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', movie.id);
                    setTimeout(() => card.classList.add('dragging'), 0);
                });
                
                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                });
                
                return card;
            }
            
            // Update movie title
            function updateMovieTitle(movieId, newTitle) {
                const movie = movies.find(m => m.id === movieId);
                if (movie) {
                    movie.title = newTitle;
                    saveData();
                    renderMovies();
                }
            }
            
            // Delete movie
            function deleteMovie(movieId) {
                movies = movies.filter(movie => movie.id !== movieId);
                history = history.filter(item => item.id !== movieId);
                saveData();
                renderMovies();
            }
            
            // Play movie
            function playMovie(movie) {
                currentMovie = movie;
                streamingTitle.textContent = movie.title;
                streamingId.textContent = movie.id;
                moviePlayer.src = `https://vidsrc.xyz/embed/movie/${movie.id}`;
                
                // Show appropriate buttons
                if (movie.status === 'plan') {
                    moveToWatching.classList.remove('hidden');
                    moveToCompleted.classList.remove('hidden');
                } else if (movie.status === 'watching') {
                    moveToWatching.classList.add('hidden');
                    moveToCompleted.classList.remove('hidden');
                } else {
                    moveToWatching.classList.add('hidden');
                    moveToCompleted.classList.add('hidden');
                }
                
                // Navigate to streaming page
                trackerPage.classList.add('hidden');
                streamingPage.classList.remove('hidden');
                streamingLink.classList.add('active');
                trackerLink.classList.remove('active');
            }
            
            // Update movie status
            function updateMovieStatus(movieId, newStatus) {
                const movie = movies.find(m => m.id === movieId);
                if (movie) {
                    const oldStatus = movie.status;
                    movie.status = newStatus;
                    
                    // If moved to completed, add to history
                    if (newStatus === 'completed' && oldStatus !== 'completed') {
                        movie.completedDate = new Date().toISOString().split('T')[0];
                        history.push({
                            id: movie.id,
                            title: movie.title,
                            date: movie.completedDate
                        });
                    }
                    
                    saveData();
                    renderMovies();
                    
                    // Update streaming page if this is the current movie
                    if (currentMovie && currentMovie.id === movieId) {
                        if (newStatus === 'plan') {
                            moveToWatching.classList.remove('hidden');
                            moveToCompleted.classList.remove('hidden');
                        } else if (newStatus === 'watching') {
                            moveToWatching.classList.add('hidden');
                            moveToCompleted.classList.remove('hidden');
                        } else {
                            moveToWatching.classList.add('hidden');
                            moveToCompleted.classList.add('hidden');
                        }
                    }
                }
            }
            
            // Render history timeline
            function renderHistory() {
                // Clear timeline
                historyTimeline.innerHTML = '';
                
                // Sort history by date (newest first)
                const sortedHistory = [...history].sort((a, b) => 
                    new Date(b.date) - new Date(a.date)
                );
                
                // Render history items
                sortedHistory.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'timeline-item mb-8 pb-8 relative pl-6';
                    historyItem.innerHTML = `
                        <div class="text-sm text-gray-400">${formatDate(item.date)}</div>
                        <div class="mt-1 bg-darker p-4 rounded-lg">
                            <div class="font-medium">${item.title}</div>
                            <div class="text-sm text-gray-400">${item.id}</div>
                        </div>
                    `;
                    historyTimeline.appendChild(historyItem);
                });
                
                // If no history, show message
                if (sortedHistory.length === 0) {
                    historyTimeline.innerHTML = '<p class="text-gray-500 text-center py-8">No completed movies yet. Start watching!</p>';
                }
            }
            
            // Format date
            function formatDate(dateString) {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(dateString).toLocaleDateString(undefined, options);
            }
            
            // Drag and drop setup
            const listContainers = document.querySelectorAll('.list-container');
            
            listContainers.forEach(container => {
                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    container.classList.add('bg-gray-800');
                });
                
                container.addEventListener('dragleave', () => {
                    container.classList.remove('bg-gray-800');
                });
                
                container.addEventListener('drop', (e) => {
                    e.preventDefault();
                    container.classList.remove('bg-gray-800');
                    
                    const movieId = e.dataTransfer.getData('text/plain');
                    const newStatus = container.dataset.status;
                    
                    updateMovieStatus(movieId, newStatus);
                });
            });
            
            // Search functionality
            searchInput.addEventListener('input', renderMovies);
            
            // Initialize
            renderMovies();
        });
    </script>
</body>
</html>
